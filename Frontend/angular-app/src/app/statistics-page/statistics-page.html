<div class="statistics-container">

  <div class="selectors">
    <div class="selector-group">
      <label for="startDate">Von:</label>
      <input type="date" id="startDate" [(ngModel)]="startDate" (change)="loadStatistics()">
    </div>

    <div class="selector-group">
      <label for="endDate">Bis:</label>
      <input type="date" id="endDate" [(ngModel)]="endDate" (change)="loadStatistics()">
    </div>

    <div class="selector-group">
      <label>Diagrammtyp:</label>
      <div class="chart-type-buttons">
        <button [class.active]="selectedChartType==='bar'" (click)="toggleChartType('bar')">Balken</button>
        <button [class.active]="selectedChartType==='line'" [disabled]="days.length < 5" (click)="toggleChartType('line')">Linie</button>
      </div>
    </div>

    <div class="spacer"></div>

    <button class="export-btn" (click)="exportFinancePDF()">PDF exportieren</button>
  </div>

  <section class="summary-cards">
    <div class="card">
      <span>Bestellungen</span>
      <div class="value-trend">
        <strong>{{ totalOrders }}</strong>
        <span class="badge" [ngClass]="{'up': trendOrders==='up', 'down': trendOrders==='down'}">
          <span class="trend-icon">{{ trendOrders==='up' ? '▲' : '▼' }}</span>
        </span>
      </div>
    </div>

    <div class="card">
      <span>Ø Warenkorb</span>
      <div class="value-trend">
        <strong>{{ avgBasket | currency:'EUR' }}</strong>
      </div>
    </div>

    <div class="card">
      <span>Umsatz (Brutto)</span>
      <div class="value-trend">
        <strong>{{ totalRevenue | currency:'EUR' }}</strong>
        <span class="badge" [ngClass]="{'up': trendRevenue==='up', 'down': trendRevenue==='down'}">
          <span class="trend-icon">{{ trendRevenue==='up' ? '▲' : '▼' }}</span>
        </span>
      </div>
    </div>
  </section>

  <div class="alerts" *ngIf="alerts?.length">
    <div class="alert" *ngFor="let a of alerts" [ngClass]="a.severity">
      <div class="icon">{{ a.severity==='danger' ? '⛔' : a.severity==='warn' ? '⚠️' : 'ℹ️' }}</div>
      <div>{{ a.message }}</div>
    </div>
  </div>

  <section class="orders-section" *ngIf="days?.length">
    <h2>Bestellungen</h2>
    <div *ngFor="let day of days" class="day-orders">
      <h3>{{ day.date }}</h3>
      <ul>
        <li *ngFor="let order of day.ordersList">
          #{{ order.id }} — {{ order.user?.name }} — {{ order.totalPrice | currency:'EUR' }}
        </li>
      </ul>
    </div>
  </section>

  <section class="chart-section" (click)="goFullscreenMobile()">
    <h2>Diagramm</h2>
    <div class="chart-container">
      <canvas #chartCanvas></canvas>
    </div>
    <span class="hint">Tippe auf das Diagramm (Mobil) für Vollbild.</span>
  </section>

<section class="orders-section">
  <h2>Finanzübersicht</h2>
  <div class="finance-table-wrap">
    <table class="finance-table">
      <thead>
        <tr>
          <th>Datum / Woche</th>
          <th>Bestellungen</th>
          <th>Umsatz Brutto</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let r of financeRows">
          <td>{{ r.label }}</td>
          <td>{{ r.orders }}</td>
          <td>{{ r.gross | currency:'EUR' }}</td>
        </tr>
      </tbody>
    </table>
            <div class="impressum-mobile">
              <button class="impressum-btn" (click)="showImpressumPopup = true">Impressum</button>
            </div>

            <div class="impressum-popup-overlay" *ngIf="showImpressumPopup" (click)="showImpressumPopup = false">
              <div class="impressum-popup" (click)="$event.stopPropagation()">
                <h2>Impressum</h2>
                <div class="impressum-details">
                  <p><strong>Firma Muster GmbH</strong></p>
                  <p>Musterstraße 1, 12345 Musterstadt</p>
                  <p>Tel: 01234 / 567890</p>
                  <p>E-Mail: info@musterfirma.de</p>
                </div>
                <button class="close-btn" (click)="showImpressumPopup = false">Schließen</button>
              </div>
            </div>
</div>
